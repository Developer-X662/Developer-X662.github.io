<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="我的第一篇博客">
<title>多态与虚函数概念入门</title>

<link rel='canonical' href='http://localhost:1313/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/'>

<link rel="stylesheet" href="/scss/style.min.4d36f8dc1fd48129e1635deb4b8eb2870fa09474f7280c4cb606d40b2526994b.css"><meta property='og:title' content="多态与虚函数概念入门">
<meta property='og:description' content="我的第一篇博客">
<meta property='og:url' content='http://localhost:1313/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/'>
<meta property='og:site_name' content='原野的Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-11-23T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-11-23T00:00:00&#43;00:00'/><meta property='og:image' content='http://localhost:1313/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/bigboss.png' />
<meta name="twitter:title" content="多态与虚函数概念入门">
<meta name="twitter:description" content="我的第一篇博客"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='http://localhost:1313/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/bigboss.png' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_640ce37d9ee4128a.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">✝️</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">原野的Blog</a></h1>
            <h2 class="site-description">不积跬步，无以至千里</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://scp-wiki-cn.wikidot.com/black-scar-s-personnel-file'
                        target="_blank"
                        title="写手主页"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
	 viewBox="0 0 512 512" xml:space="preserve">
<rect x="443.733" y="34.133" style="fill:#F490C0;" width="34.133" height="34.133"/>
<polygon style="fill:#FFDAAA;" points="204.8,443.733 204.8,409.6 238.933,409.6 238.933,375.467 273.067,375.467 273.067,341.333 
	307.2,341.333 307.2,307.2 341.333,307.2 341.333,273.067 375.467,273.067 375.467,238.933 409.6,238.933 409.6,204.8 
	443.733,204.8 443.733,170.667 477.867,170.667 477.867,136.533 512,136.533 512,68.267 477.867,68.267 477.867,34.133 
	443.733,34.133 443.733,0 375.467,0 375.467,34.133 375.467,34.133 341.333,34.133 341.333,68.267 307.2,68.267 307.2,102.4 
	273.067,102.4 273.067,136.533 238.933,136.533 238.933,170.667 204.8,170.667 204.8,204.8 170.667,204.8 170.667,238.933 
	136.533,238.933 136.533,273.067 102.4,273.067 102.4,307.2 68.267,307.2 68.267,341.333 34.133,341.333 34.133,375.467 
	34.133,375.467 0,375.467 0,512 512,512 512,477.867 170.667,477.867 170.667,443.733 "/>
<polygon style="fill:#FF9811;" points="477.867,68.267 477.867,34.133 443.733,34.133 443.733,0 375.467,0 375.467,34.133 
	341.333,34.133 341.333,68.267 307.2,68.267 307.2,102.4 273.067,102.4 273.067,136.533 238.933,136.533 238.933,170.667 
	204.8,170.667 204.8,204.8 170.667,204.8 170.667,238.933 136.533,238.933 136.533,273.067 102.4,273.067 102.4,307.2 68.267,307.2 
	68.267,341.333 34.133,341.333 34.133,375.467 68.267,375.467 68.267,409.6 102.4,409.6 102.4,443.733 136.533,443.733 
	136.533,477.867 170.667,477.867 170.667,443.733 204.8,443.733 204.8,409.6 238.933,409.6 238.933,375.467 273.067,375.467 
	273.067,341.333 307.2,341.333 307.2,307.2 341.333,307.2 341.333,273.067 375.467,273.067 375.467,238.933 409.6,238.933 
	409.6,204.8 443.733,204.8 443.733,170.667 477.867,170.667 477.867,136.533 512,136.533 512,68.267 "/>
<polygon style="fill:#FFFFFF;" points="512,68.267 477.867,68.267 477.867,34.133 443.733,34.133 443.733,0 375.467,0 
	375.467,34.133 341.333,34.133 341.333,68.267 375.467,68.267 375.467,102.4 409.6,102.4 409.6,136.533 443.733,136.533 
	443.733,170.667 477.867,170.667 477.867,136.533 512,136.533 "/>
<polygon style="fill:#FFDA44;" points="341.333,34.133 341.333,68.267 307.2,68.267 307.2,102.4 273.067,102.4 273.067,136.533 
	238.933,136.533 238.933,170.667 204.8,170.667 204.8,204.8 170.667,204.8 170.667,238.933 136.533,238.933 136.533,273.067 
	102.4,273.067 102.4,307.2 68.267,307.2 68.267,341.333 34.133,341.333 34.133,375.467 102.4,375.467 102.4,341.333 
	136.533,341.333 136.533,307.2 170.667,307.2 170.667,273.067 204.8,273.067 204.8,238.933 238.933,238.933 238.933,204.8 
	273.067,204.8 273.067,170.667 307.2,170.667 307.2,136.533 341.333,136.533 341.333,102.4 375.467,102.4 375.467,34.133 "/>
<rect x="34.133" y="341.333" width="34.133" height="34.133"/>
<rect x="68.267" y="307.2" width="34.133" height="34.133"/>
<rect x="102.4" y="273.067" width="34.133" height="34.133"/>
<rect x="136.533" y="238.933" width="34.133" height="34.133"/>
<rect x="170.667" y="204.8" width="34.133" height="34.133"/>
<rect x="204.8" y="170.667" width="34.133" height="34.133"/>
<rect x="238.933" y="136.533" width="34.133" height="34.133"/>
<rect x="273.067" y="102.4" width="34.133" height="34.133"/>
<rect x="307.2" y="68.267" width="34.133" height="34.133"/>
<rect x="375.467" width="68.267" height="34.133"/>
<polygon points="136.533,443.733 136.533,477.867 68.267,477.867 68.267,443.733 34.133,443.733 34.133,375.467 0,375.467 0,512 
	512,512 512,477.867 170.667,477.867 170.667,443.733 "/>
<rect x="170.667" y="409.6" width="34.133" height="34.133"/>
<rect x="204.8" y="375.467" width="34.133" height="34.133"/>
<rect x="238.933" y="341.333" width="34.133" height="34.133"/>
<rect x="273.067" y="307.2" width="34.133" height="34.133"/>
<rect x="307.2" y="273.067" width="34.133" height="34.133"/>
<rect x="341.333" y="238.933" width="34.133" height="34.133"/>
<rect x="375.467" y="204.8" width="34.133" height="34.133"/>
<rect x="409.6" y="170.667" width="34.133" height="34.133"/>
<rect x="477.867" y="68.267" width="34.133" height="68.267"/>
<rect x="375.467" y="68.267" width="34.133" height="34.133"/>
<rect x="409.6" y="102.4" width="34.133" height="34.133"/>
<rect x="341.333" y="34.133" width="34.133" height="34.133"/>
<rect x="443.733" y="136.533" width="34.133" height="34.133"/>
<rect x="68.267" y="375.467" width="34.133" height="34.133"/>
<rect x="102.4" y="409.6" width="34.133" height="34.133"/>
<rect x="443.733" y="34.133" width="34.133" height="34.133"/>
</svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E-about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于 | about</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档 | archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索 | search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%B7%A5%E5%85%B7-tools/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>工具 | tools</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#引子">引子</a></li>
    <li><a href="#什么是多态">什么是多态？</a></li>
    <li><a href="#什么是虚函数">什么是虚函数？</a></li>
    <li><a href="#补充内容">补充内容</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/">
                <img src="/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/bigboss_hu_649d6f627c0d46c4.png"
                        srcset="/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/bigboss_hu_649d6f627c0d46c4.png 800w, /p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/bigboss_hu_6d72eb37564c85c.png 1600w"
                        width="800" 
                        height="330" 
                        loading="lazy"
                        alt="Featured image of post 多态与虚函数概念入门" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/c&#43;&#43;/" >
                C&#43;&#43;
            </a>
        
            <a href="/categories/%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" >
                基础语法
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/">多态与虚函数概念入门</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            我的第一篇博客
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published" datetime='2025-11-23T00:00:00Z'>Nov 23, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 5 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="引子">引子
</h2><p>首先看如下的代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;QDebug&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Animal</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">bark</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Animal bark！&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Dog</span><span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">bark</span><span class="p">()</span> <span class="k">override</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Dog bark!&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Animal</span><span class="o">*</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Animal</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">e</span><span class="o">-&gt;</span><span class="n">bark</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//注意下面这一句
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Animal</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Dog</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">-&gt;</span><span class="n">bark</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>让我们运行以上代码，得到这样的输出结果：</p>
<p><img src="/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/image.png"
	width="474"
	height="175"
	srcset="/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/image_hu_968ee1e0c6982a76.png 480w, /p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/image_hu_5fcbb57f42c62771.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="270"
		data-flex-basis="650px"
	
></p>
<p>别的先不管，首先注意代码中<code>Animal* p = new Dog();</code>这一句，其中<code>new Dog()</code>这一句我们知道是一个构造函数，返回的应该是一个指向Dog类型的指针（<code>Dog*</code>）。然而我们又注意到p实际上是<code>Animal*</code>类型的，那么第一个问题就来了——</p>
<blockquote>
<p>Question1：=两边类型不同，那么为什么这里编译器没有报错呢？</p>
</blockquote>
<p>答案是，这种机制叫做多态。</p>
<h2 id="什么是多态">什么是多态？
</h2><p>C++允许使用基类指针或引用来调用子类的重写方法，从而使得同一接口可以表现不同的行为，即“一个接口，多种实现”，而这种机制就被称为多态。</p>
<p>由于多态的核心是“一个接口，多种实现”，因此在 C++ 里，子类指针可以自动转换成父类指针，这叫做<em>向上转型（upcasting）</em>。在上面的例子中，由于Dog类继承了Animal类，因此作为Animal类的子类，指向Dog类的指针可以被自动转换为指向Animal类的指针。</p>
<p>当然读者大概也能猜到，与<em>向上转型（upcasting）<em>相对的还有</em>向下转型（downcasting）</em>，与前者相比，这是一种不安全的语法。在此我们先不过多纠缠这个问题。</p>
<p>然而，即便我们已经了解了多态的设计目标，但技术层面的问题依然存在——</p>
<blockquote>
<p>Question2：既然p是一个指向Animal类的指针，那么<code>p-&gt;bark();</code>为什么会输出Dog bark！而不是Animal bark！呢？</p>
</blockquote>
<p>这就好像，你以为你拿着的是动物签的合约，但实际上来上班的是一只狗。</p>
<p>而这就引入了第二个概念，虚函数。</p>
<h2 id="什么是虚函数">什么是虚函数？
</h2><p>虚函数是C++中用来实现多态的工具，它允许通过基类指针或引用调用派生类中同名的重写函数。没有虚函数，多态所谓“一个接口，多种实现”的目标就无法达成。</p>
<p>让我们回到Question2，实际上这个问题答案非常简单。因为指针的“静态类型”和“真实类型”并不是一回事。<code>Animal* p</code> 只是告诉编译器：“p 这个指针，<em>按语法</em> 来说可以当成 Animal 来用”，但是我们知道，<code>new Dog()</code> 产生的对象本体（也就是在堆内实际被分配的内存数据），其<strong>真身是 Dog</strong>。</p>
<p>当我们在Animal类中的<code>bark()</code>函数前加入Virtual关键字时，就是在声明<code>bark()</code>是一个虚函数。而这实际上是在告诉编译器，我要创建一种动态绑定（Dynamic Binding）关系，也就是说，直到程序运行时，才根据对象的真实类型确定函数调用的具体实现。这就区别于不使用虚函数时的静态调用。</p>
<p>如果看不懂上面的说明也没有关系。我们依然拿和动物的合约来举一个例子，想象你是《疯狂动物城》里的大先生，你现在正坐在谈判桌上，谈判正进行得如火如荼，此时你需要手下的人吼一声来威吓对手。作为老板，你只关心此时手下有人能应时来一嗓子，至于手底下谁来，吠叫的时候用什么声调搭配什么姿势，这些细枝末节的事都不是你关心的东西。</p>
<p><img src="/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/bigboss.png"
	width="1159"
	height="478"
	srcset="/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/bigboss_hu_7f518e1e2bb14762.png 480w, /p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/bigboss_hu_1a5a2930ade42dc2.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="242"
		data-flex-basis="581px"
	
></p>
<p>在上面的例子中，大先生作为虚函数的调用者，“给我叫！”（<code>bark()</code>）这一命令是永恒不变的。具体负责吠叫的手下作为实际的对象本体，具体要怎么执行大先生的命令，则取决于手下个人对于这条指令的理解（即对虚函数的重写）。而到底让哪个动物来执行大先生的命令，则取决于你，即程序的编写者，实际让<code>Animal* p</code>指向哪种类型的动物。</p>
<p>从上面的代码中，我们还可以得知这些语法知识：</p>
<ol>
<li>关键字<code>virtual</code>用于标识基类（Animal类）中某个函数为虚函数，<code>override</code>关键字用于在派生类（Dog类）中标识某个函数为基类中虚函数的重写。</li>
<li>关键字<code>virtual</code>是必需的，但<code>override</code>关键字不是必需的，只是用作函数覆盖的标识，对于机器来说不写也完全没有问题。但从人类的角度出发，出于代码可读性的考虑还是推荐加上。</li>
</ol>
<h2 id="补充内容">补充内容
</h2><p>好了，到这里你已经很好地理解了多态和虚函数的概念。</p>
<p>然而，在编译器读到Virtual关键字后，此时站在编译的角度，到底发生了什么呢？</p>
<p>也就是说，我们想知道的是——</p>
<blockquote>
<p>Question3：从编译的角度出发，虚函数具体是如何被调用的呢？</p>
</blockquote>
<p><strong>注意：</strong></p>
<p><strong>以下内容可能理解起来有一定难度，哪怕第一时间没看懂也没关系，留个印象就可以。</strong></p>
<p>每当创建一个包含有虚函数的类或从包含有虚函数的类派生一个类时，编译器就会为这个类创建一个虚函数表（也叫Vtable）保存该类所有虚函数的地址；而对于每个覆写了基类虚函数的对象，其内部都具备一个被称为vptr的指针，指向自己对应的真实类型所对应的虚函数表。</p>
<p>那么对于编译器来说，虚函数表是如何构造的呢？</p>
<p><img src="/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/image1.png"
	width="842"
	height="427"
	srcset="/p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/image1_hu_c46befcdd2189558.png 480w, /p/%E5%A4%9A%E6%80%81-%E8%99%9A%E5%87%BD%E6%95%B0-%E5%85%A5%E9%97%A8/image1_hu_788f1603b6385175.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="197"
		data-flex-basis="473px"
	
></p>
<p>让我们再次复习一下我们已经熟知的概念：</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th></th>
          <th>内存中的存储位置</th>
          <th>存储内容</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>vtbl（virtual table，虚函数表）</td>
          <td>只读数据区（rodata）</td>
          <td>每个具有虚函数的类都对应一个vtbl，每个vtbl以表格形式存储自己对应类中所有虚函数的地址（虚函数与其它函数一起位于代码段）</td>
      </tr>
      <tr>
          <td>vptr</td>
          <td>所属对象内部，通常位于对象的开头</td>
          <td>自己所属对象的真实类型所对应的 vtable的地址</td>
      </tr>
      <tr>
          <td>对象</td>
          <td>存在于栈（Stack）或堆（Heap）中，若在栈（Stack）上则由编译器自动管理生命周期，若在堆（Heap）上则由程序员手动new和delete</td>
          <td>一种具有特定可控制生命周期的（构造，删除等），可以绑定函数以及属性的可复用的数据结构</td>
      </tr>
      <tr>
          <td>类</td>
          <td>不存在</td>
          <td>属性（成员变量）、方法（成员函数）</td>
      </tr>
  </tbody>
</table></div>
<p>因此回到先前的话题，从编译的角度出发，虚函数具体是如何被调用的呢？</p>
<p>在程序运行时，首先通过对象中的vptr找到其真实类型对应的vtable，通过vtable查找代码段中对应的虚函数地址，然后加以调用。</p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>本文遵循 CC BY-NC-SA 4.0 许可协议</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 原野
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.32.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.73a6d83a88e7780bdcc1baa608a779842d2acc2c78a922e1c4826d0ac19decf1.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
